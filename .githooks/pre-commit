#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"
cd "$repo_root"

staged_files=()
while IFS= read -r -d '' file; do
  case "$file" in
    *.css|*.html|*.js|*.json|*.liquid|*.md|*.scss|*.yaml|*.yml)
      staged_files+=("$file")
      ;;
  esac
done < <(git diff --cached --name-only --diff-filter=ACMR -z)

if [ "${#staged_files[@]}" -eq 0 ]; then
  exit 0
fi

if ! command -v npx >/dev/null 2>&1; then
  echo "pre-commit: npx is required to run Prettier checks."
  echo "Install Node.js/npm or bypass once with: git commit --no-verify"
  exit 1
fi

echo "pre-commit: running prettier --check on staged files..."
npx prettier --check "${staged_files[@]}"
